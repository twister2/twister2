<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>&lt;no title&gt; &mdash; Twister2 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Twister2 1.0.0 documentation" href="../../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p># Kubernetes Master Based Worker Discovery
Ahmet Uyar</p>
<p>We developed a worker discoverer that watches the pods in Kubernetes clusters by listening to
Kubernetes master. It provides the following services to workers in a Twister2 job:
* Unique ID assignment to workers
* Worker address discovery
* Getting the IP addresses after the worker pods started running</p>
<p>The worker discoverer class is:
* [edu.iu.dsc.tws.rsched.schedulers.k8s.worker.WorkerDiscoverer](../../../twister2/resource-scheduler/src/java/edu/iu/dsc/tws/rsched/schedulers/k8s/worker/WorkerDiscoverer.java)</p>
<p>It implements interface:
* [edu.iu.dsc.tws.common.discovery.IWorkerDiscoverer](../../../twister2/common/src/java/edu/iu/dsc/tws/common/discovery/IWorkerDiscoverer.java)</p>
<p>## Unique ID Assignment to Workers
Worker IDs in a Twister2 job start from 0 and increase sequentially without any gaps in between.</p>
<p>Each pod in Twister2 jobs has a unique name with a unique integer extension.
When there are n pods in a job (StatefulSet), each pod name is composed of &lt;jobname&gt;-&lt;index&gt;.
Index starts from zero and increases sequentially. Kubernetes master assigns these pod indexes.
Each container is also assigned a name that is similar to the pod names.
Container names are in the form of &lt;twister2-container&gt;-&lt;index&gt;.
Again the index starts from zero and increases sequentially in each pod.
While pod indexes are assigned by Kubernetes master, we assign the container name indexes
when we create the StatefulSets.</p>
<p>We construct unique worker IDs by using pod name and container name indexes.
The worker ID generated by the formula:</p>
<blockquote>
<div>workerID = (podIndex x ContainersPerPod) + containerIndex</div></blockquote>
<p>## Worker IP and Port Numbers
Each worker needs to have a unique &lt;IP&gt;:&lt;Port&gt; combination. Currently each worker has one TCP port.
More ports can be added later on as needed.</p>
<p>Each worker uses the IP addresses of the pod it is running in as its IP address.
IP address of each pod can be either get by using localhost or
sent to the containers as an environment variable using downward API call,
when submitting the job.</p>
<p>The port number of each non-MPI enabled worker is calculated as the basePort + containerIndex.
When there are multiple containers in a pod, each container has an increasing index starting from 0.</p>
<p>The port number of MPI enabled workers are calculate as the basePort + MPI ranking.</p>
<p>### Watching Workers to Start
Each worker watches pod running events and when a pod reaches to “Running” phase,
they assume that all workers in that pod started running.
This is not %100 accurate. It is a close assumption.
A pod may have started but some workers in that may have not started yet or stalled at some point.
This worker discoverer does not distinguish pod Running and worker starts.</p>
<p>Job Master based worker discoverer provides a more precise discovery method.
In that case, each worker reports its status. Therefore, it is more accurate.
The advantage of this one is that it works in the absence of the Job Master also.</p>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/documents/kubernetes/K8sBasedWorkerDiscovery.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, DSC-SPIDAL.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
      |
      <a href="../../_sources/documents/kubernetes/K8sBasedWorkerDiscovery.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>